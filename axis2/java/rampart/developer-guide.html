<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 from src/site/xdoc/developer-guide.xml at 01 Dec 2024
 | Rendered using Apache Maven Fluido Skin 2.0.0-M11
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0" />
    <title>Apache Rampart</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.0.0-M11.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.0.0-M11.min.js"></script>
  </head>
  <body>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1><img class="class java.lang.Object" src="images/apache-rampart-logo.jpg" /></h1></div></div>
          <div class="pull-right"><div id="bannerRight"><h1><a href="http://www.apache.org"><img class="class java.lang.Object" src="http://www.apache.org/images/asf_logo_wide.png" /></a></h1></div></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 01 Dec 2024<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.8.0</li>
        <li class="pull-right"><a href="../core/">Apache Axis2/Java</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Apache Rampart</li>
    <li><a href="index.html">Home</a></li>
    <li><a href="javascript:void(0)"><span class="icon-chevron-down"></span>Downloads</a>
     <ul class="nav nav-list">
      <li><a href="download.html">Releases</a></li>
     </ul></li>
    <li><a href="javascript:void(0)"><span class="icon-chevron-down"></span>Release Notes</a>
     <ul class="nav nav-list">
      <li><a href="release-notes/1.6.1.html">1.6.1</a></li>
      <li><a href="release-notes/1.6.2.html">1.6.2</a></li>
      <li><a href="release-notes/1.6.3.html">1.6.3</a></li>
      <li><a href="release-notes/1.6.4.html">1.6.4</a></li>
      <li><a href="release-notes/1.7.0.html">1.7.0</a></li>
      <li><a href="release-notes/1.8.0.html">1.8.0</a></li>
     </ul></li>
   <li class="nav-header">Documentation</li>
    <li><a href="quick-start.html">Getting Started</a></li>
    <li><a href="samples.html">Samples</a></li>
    <li><a href="http://wiki.apache.org/ws/FrontPage/Rampart/FAQ" class="externalLink">FAQ</a></li>
    <li><a href="rampartconfig-guide.html">Rampart Configuration</a></li>
    <li><a href="setting-up-sts.html">STS Configuration</a></li>
    <li class="active"><a>Developer Guide</a></li>
   <li class="nav-header">Resources</li>
    <li><a href="articles.html">Articles</a></li>
    <li><a href="specifications.html">Specifications</a></li>
    <li><a href="apidocs/index.html">Online Javadocs</a></li>
   <li class="nav-header">Project Information</li>
    <li><a href="team.html">Project Team</a></li>
    <li><a href="http://issues.apache.org/jira/browse/Rampart" class="externalLink">Issue Tracking</a></li>
    <li><a href="mailing-lists.html">Mailing Lists</a></li>
    <li><a href="https://github.com/apache/axis-axis2-java-rampart" class="externalLink">Source Code</a></li>
    <li><a href="http://www.apache.org/licenses/" class="externalLink">License</a></li>
    <li><a href="http://www.apache.org/foundation/sponsorship.html" class="externalLink">Sponsorship</a></li>
    <li><a href="http://www.apache.org/foundation/thanks.html" class="externalLink">Thanks</a></li>
    <li><a href="http://www.apache.org/security/" class="externalLink">Security</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">
<html xmlns="http://www.w3.org/1999/xhtml">

<section><a id="Apache_Rampart_Developer_Guide"></a>
<h1>Apache Rampart Developer Guide</h1> 
<section><a id="Getting_Involved_in_Rampart"></a>
<h2>Getting Involved in Rampart</h2>

<section><a id="Introduction"></a>
<h3>Introduction</h3>

Components of Rampart

<ul>
  
<li>Rampart Core</li>
  
<li>Rampart Policy</li>
  
<li>Rampart Trust</li>
</ul>


<p></p>
<img src="images/security-stack.jpg" alt="Rampart Components and WS-Security Stack" title="Rampart Components and WS-Security Stack" />


<p><strong><em>Figure 1 : Rampart Components and WS-Security
Stack</em></strong></p>

</section><section><a id="Building_Rampart"></a>
<h3>Building Rampart</h3>

<ol style="list-style-type: decimal;">
  
<li>Install maven3. Refer to the <a href="http://maven.apache.org/guides/getting-started/maven-in-five-minutes.html" class="externalLink">Installation
    guide</a>.</li>
  
<li>Download the source code.
    
<ul>
      
<li>Checkout <a href="https://github.com/apache/axis-axis2-java-rampart" class="externalLink">https://github.com/apache/axis-axis2-java-rampart/</a></li>
    </ul>
  </li>
  
<li>The Rampart project has 8 modules under it. They are:
    
<ul>
      
<li>rampart-policy contains security policy assertions.</li>
      
<li>rampart-core has core components that process and enforce
      security.</li>
      
<li>rampart-trust contains trust components.</li>
      
<li>rampart-mar builds the rampart.mar that is deployed in the
        &quot;modules&quot; directory of the Axis2 repository.</li>
      
<li>rampart-trust-mar builds the rahas.mar that adds WS-Trust into
        Axis2.</li>
      
<li>rampart-test has a set of unit test cases.</li>
      
<li>integration-test has functional tests.</li>
      
<li>rampart-samples consist of samples provided with the
      distribution.</li>
    </ul>
  </li>
  
<li>Build by typing <code>$mvn clean install</code></li>
</ol>


<p>When deploying rampart.mar and rampart-trust.mar in the Axis2 repository,
you may notice that they do not contain any dependencies. Therefore all the
dependencies must be in the classpath.</p>

</section><section><a id="Rampart_in_Axis2"></a>
<h3>Rampart in Axis2</h3>


<p>Rampart is deployed as a module in Axis2, in the security phase. The
security phase is right after the transport phase. The Rampart module
introduces a couple of handlers -
&quot;org.apache.rampart.handler.RampartReciever&quot; and
&quot;org.apache.rampart.handler.RampartSender&quot; to the security phase.</p>


<p></p>
<img src="images/rampart-handlers.jpg" alt="DOOM" title="Rampart in Axis2" />


<p><strong><em>Figure 2 : Rampart in Axis2</em></strong></p>


<p>The &quot;RampartReceiver&quot; handler intercepts the incoming message. Then Rampart
validates the security of the incoming message, and checks whether it is
in-line with the specified security policy. All security actions such as
decryption of the message, validating the digital signature, validating the
timestamp, and authenticating the user happens inside the Rampart module.</p>


<p>&quot;RampartSender&quot; is the last handler in the outflow. The outgoing message
is intercepted by this handler and Rampart takes the security actions. For
example SOAP message can be encrypted, digitally signed, and security tokens
are included according to the security policy.</p>

</section><section><a id="Rampart.2C_WSS4J.2C_and_DOOM"></a>
<h3>Rampart, WSS4J, and DOOM</h3>


<p>Rampart uses WSS4J for securing SOAP messages. WSS4J is an Apache project
which implements the WS-Security specification. SOAP messages are signed and
encrypted according to the <a href="http://www.w3.org/TR/xmlenc-core/" class="externalLink">XML
Encryption</a> and <a href="http://www.w3.org/TR/xmldsig-core/" class="externalLink">XML Digital
Signature</a> specifications, but the WS-Security specification introduces an
additional set of rules. Therefore WSS4J ensures that SOAP messages are
singed according to all the rules defined in the specifications. WSS4J uses
Apache's <a href="http://santuario.apache.org/Java/index.html" class="externalLink">xmlsec
libraries</a> for XML Encryption and XML Digital Signature.</p>


<p>Rather than re-inventing the wheel, it was decided to use WSS4J for SOAP
message security in Rampart but there was a fundamental problem. WSS4J and
all the incorporating XML security libraries use &quot;DOM&quot; for parsing and
generating XML, while Axis2 uses &quot;AXIOM&quot; as the object model. This was
resolved by using a new object model named &quot;DOOM&quot;. DOOM is both AXIOM and DOM
implementations. Therefore you can manipulate/access a DOOM object structure
through DOM interfaces and AXIOM interfaces.</p>


<p>When Rampart is engaged and configured, the incoming SOAP messages are
converted to DOOM. Since DOOM implements the DOM interface it is possible for
WSS4J to process messages. After performing the security validations, before
flushing the message down the message inflow, the DOOM SOAP message is
converted back to OM. At the outgoing flow, the message is converted to DOOM
and then the security functions are performed using WSS4J.</p>

</section><section><a id="Rampart_Core"></a>
<h3>Rampart Core</h3>


<p>Rampart core drives security enforcement and validation on SOAP messages.
It binds all components together to create the final product. The important
components of Rampart core are,</p>

<ul>
  
<li>org.apache.rampart.RampartEngine</li>
  
<li>org.apache.rampart.MessageBuilder</li>
</ul>


<p><strong>SOAP Message Inflow</strong></p>


<p>Incoming messages are intercepted by RampartReciver and handed over to the
RampartEngine. RampartEngine is responsible for handling validation of
security in the incoming SOAP message.</p>
<img src="images/rampart-engine.jpg" alt="Rampart Engine" title="Rampart Engine" />


<p><strong><em>Figure 3: Control flow in RampartEngine</em></strong></p>


<p><strong>Note</strong>: RampartMessageData stores
&quot;org.apache.rampart.policy.RampartPolicyData&quot;, which contains security policy
in the manner required by &quot;RampartEngine&quot; and &quot;MessageBuilder&quot;.</p>


<p><strong>SOAP Message Outflow</strong></p>


<p>Outgoing messages are intercepted by RampartSender and handed over to
org.apache.rampart.RampartMessageBuilder. It is responsible for enforcing
security on an outgoing SOAP message.</p>
<img src="images/message-builder.jpg" alt="Message Builder" title="Message Builder" />


<p><strong><em>Figure 4: Control flow in MessageBuilder</em></strong></p>

</section><section><a id="Rampart_Policy"></a>
<h3>Rampart Policy</h3>


<p>WS - Security Policy is an extension of WS-Policy specification.
Corresponding to this, the implementation of the security policy in Rampart
is based on &quot;Neethi&quot;, which is the Apache implementation of WS Policy
specification. For each policy assertion introduced in the WS-Security
Policy, there is an &quot;Assertion Builder&quot; and an &quot;Assertion Model&quot; defined in
Rampart-policy.</p>


<p>Apache Neethi is a highly extensible framework. When reading a security
policy file, these builders and models in Rampart Policy are picked up by the
Neethi framework using the &quot;Jar file Service Provider Mechanism&quot;. All Rampart
builders are listed in the
META-INF/services/org.apache.neethi.builders.AssertionBuilder file. When
adding a new Policy assertion it requires only a builder, assertion model,
and an entry in the file.</p>


<p>The RampartPolicyBuilder creates a RampartPolicyData given a &quot;Policy&quot;
object created using the Rampart-policy and Neethi frameworks.</p>

</section><section><a id="Rampart_Trust"></a>
<h3>Rampart Trust</h3>


<p>Rampart Trust implements the WS-Trust specification, which can be used
in-conjunction with the Rampart Core and Rampart Policy modules. Rampart
Trust defines a framework that can be used to issue, cancel, renew, and
validate tokens, i.e., it defines a set of interfaces that must be
implemented by different token issuing parties. Basically, Rampart Trust
provides the functionality needed to host a STS - Security Token Service.</p>
<img src="images/rampart-trust.jpg" alt="Rampart Trust" title="Rampart Trust" />


<p><strong><em>Figure 5: Control flow in Rampart Trust</em></strong></p>


<p></p>


<p></p>


<p></p>

</section><section><a id="Release_process_and_release_preparation"></a>
<h3>Release process and release preparation</h3>

<p>Check that all dependencies and plugins are available from standard repositories. To do this, clean the local repository and execute 'mvn clean install followed by 'mvn site'</p>


<p>Check that the set of license files in the legal directory is complete and accurate (by checking that in the binary distribution for every third party JAR in the lib directory. </p>


<p>Check that the apache-release profile (see the 'parent' reference in the top level pom.xml, and https://maven.apache.org/pom/asf/) can be executed properly. To do this, issue the following command: mvn clean install -Papache-release -DskipTests=true</p>


<p>You may also execute a dry run of the release process: mvn release:prepare -DdryRun=true. In a dry run, the generated zip files will still be labled as SNAPSHOT. After this, you need to clean up using the following command: mvn release:clean</p>


<p>Check that the Maven site can be generated and deployed successfully, and that it has the expected content.</p>


<p>To generate the entire documentation in one place, complete with working inter-module links, execute the site-deploy phase (and check the files under target/staging). A quick and reliable way of doing that is to use the following command: mvn -Dmaven.test.skip=true clean package site-deploy</p>


<p>Complete the release notes in the new src/site/markdown/release-notes .md file, i.e. 2.0.0.md.  It should include a description of the major changes in the release as well as a list of resolved JIRA issues.</p>

</section><section><a id="Prerequisites"></a>
<h3>Prerequisites</h3>


<p>The following things are required to perform the actual release:</p>


<p>A PGP key that conforms to the <a href="http://specs.xmlsoap.org/ws/2005/02/trust/WS-Trust.pdf" class="externalLink"> requirement for Apache release signing</a></p>


<p>To make the release process easier, the passphrase for the code signing key should be configured in ~/.m2/settings.xml</p>

<code>&lt;settings&gt;
  ...
  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;apache-release&lt;/id&gt;
      &lt;properties&gt;
        &lt;gpg.passphrase&gt;&lt;!-- KEY PASSPHRASE --&gt;&lt;/gpg.passphrase&gt;
      &lt;/properties&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
  ...
&lt;/settings&gt;

</code>


<p>The release process uses a Nexus staging repository. Every committer should have access to the corresponding staging profile in Nexus. To validate this, login to repository.apache.org and check that you can see the org.apache.axis staging profile. The credentials used to deploy to Nexus should be added to settings.xml</p>
                        
</section><section><a id="Release"></a>
<h3>Release</h3>


<p>In order to prepare the release artifacts for vote, execute the following steps:</p>


<p>If necessary, update the copyright date in the top level NOTICE file.</p>


<p>Start the release process with the following command - use 'mvn release:rollback' to undo:</p>

<code>mvn release:prepare</code>


<p>When asked for the &quot;SCM release tag or label&quot;, keep the default value (x.y.z) </p>


<p>The above command will create a tag in Subversion and increment the version number of the trunk to the next development version. It will also create a release.properties file that will be used in the next step.</p>


<p>Perform the release using the following command: </p>

<code>mvn release:perform</code>


<p>This will upload the release artifacts to the Nexus staging repository.</p>


<p>Close the staging repository. The name of the staging profile is org.apache.axis. See <a href="https://maven.apache.org/developers/release/maven-project-release-procedure.html" class="externalLink"> for a more thorough description of this step. </a></p>


<p>Execute the target/checkout/etc/dist.py script to upload the source and binary distributions to the development area of the <a href="https://dist.apache.org/repos/dist/" class="externalLink"> repository. </a></p>


<p>If not yet done, export your public key and <a href="https://dist.apache.org/repos/dist/release/axis/axis2/java/rampart/KEYS" class="externalLink"> append it here. </a></p>


<p>The command to export a public key is as follows:</p>

<code>gpg --armor --export key_id</code>


<p>Create a new staging area for the site:</p>

<code>svn copy https://svn.apache.org/repos/asf/axis/site/axis2/java/rampart https://svn.apache.org/repos/asf/axis/site/axis2/java/rampart-staging</code>


<p>This step can be skipped if the staging area has already been created earlier (e.g. to test a snapshot version of the site).</p>


<p>Change to the target/checkout directory and prepare the site using the following commands:</p>

<code>mvn site-deploy ; mvn scm-publish:publish-scm -Dscmpublish.skipCheckin=true</code>


<p>The staging area will be checked out to target/scmpublish-checkout (relative to target/checkout). Do a sanity check on the changes and then commit them.</p>


<p>Start the release vote by sending a mail to java-dev@axis.apache.org . The mail should mention the list of issues solved in the release (by linking to the relevant JIRA view).</p>
                            

<p>Include a link to the location of the Nexus staging repository, and a link to the <a href="https://dist.apache.org/repos/dist/dev/axis/axis2/java/rampart/" class="externalLink"> source and binary distributions. </a></p>


<p>A link to the preview of the <a href="https://axis.apache.org/axis2/java/rampart-staging/" class="externalLink"> Maven site. </a></p>


<p>If the vote passes, execute the following steps:</p>


<p>Promote the artifacts in the staging repository. See<a href="https://central.sonatype.org/publish/release/#close-and-drop-or-release-your-staging-repository" class="externalLink"> for detailed instructions for this step.</a></p>


<p>Publish the distributions:</p>


<code>svn mv https://dist.apache.org/repos/dist/dev/axis/axis2/java/rampart/ https://dist.apache.org/repos/dist/release/axis/axis2/java/rampart</code>


<p>Publish the site:</p>

<code>svn co --depth=immediates https://svn.apache.org/repos/asf/axis/site/ site ; cd site/axis2/java ; svn rm rampart ; svn mv rampart-staging rampart ; svn commit</code>


<p>It may take several hours before all the updates have been synchronized to the relevant ASF systems. Before proceeding, check that the Maven artifacts for the release are available from the Maven central repository, and the <a href="https://axis.apache.org/axis2/java/rampart/" class="externalLink"> Rampart Maven site has been synchronized.</a></p>


<p>Verify the binary and source distributions can be downloaded from the<a href="https://axis.apache.org/axis2/java/rampart/download.html" class="externalLink"> Rampart download page.</a></p>


<p>Once everything is in place, send announcements to java-dev@axis.apache.org and announce@apache.org. Since the two lists have different conventions, audiences and moderation policies, to send the announcement separately to the two lists.</p>


<p>Sample announcement:</p>


<p>Apache Rampart Team is pleased to announce the release of Rampart x.y.z. The release is available for download at:</p>


<p>https://axis.apache.org/axis2/java/rampart/download.html</p>


<p>Apache Rampart provides implementations of the WS-Sec* specifications for Apache Axis2, based on Apache WSS4J and the Apache Axiom DOOM implementation.</p>

</section></section>
</html>        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2005–2024
<a href="http://www.apache.org">Apache Software Foundation</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>